## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
long = separate_(long, "var",
into = c("line", "type"),
sep = fixed("."))
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
## ------------------------------------------------------------------------
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
?separate
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
## ------------------------------------------------------------------------
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
head(long)
table(long$line)
table(long$type)
## ------------------------------------------------------------------------
# have to remove missing days
wide = filter(long, !is.na(date))
?spread
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
## ------------------------------------------------------------------------
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
head(long)
table(long$line)
table(long$type)
## ------------------------------------------------------------------------
# have to remove missing days
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
## ------------------------------------------------------------------------
# wide = wide %>%
#     select(Alightings, Average, Boardings) %>%
#     mutate(good = rowSums(is.na(.)) > 0)
namat = !is.na(select(wide, Alightings, Average, Boardings))
head(namat)
wide$good = rowSums(namat) > 0
head(wide, 3)
head(wide, 10)
?merge
all = 5
all()
all(all > 4)
all(all < 3)
rm("all")
all(all < 3)
?merge
wide = filter(wide, good) %>% select(-good)
head(wide)
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
## ------------------------------------------------------------------------
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
head(long)
table(long$line)
table(long$type)
## ------------------------------------------------------------------------
# have to remove missing days
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
## ------------------------------------------------------------------------
# wide = wide %>%
#     select(Alightings, Average, Boardings) %>%
#     mutate(good = rowSums(is.na(.)) > 0)
namat = !is.na(select(wide, Alightings, Average, Boardings))
head(namat)
wide$good = rowSums(namat) > 0
head(wide, 3)
## ------------------------------------------------------------------------
wide = filter(wide, good) %>% select(-good)
head(wide)
## ----merging-------------------------------------------------------------
base <- data.frame(id = 1:10, Age= seq(55,60, length=10))
base[1:2,]
visits <- data.frame(id = rep(1:8, 3), visit= rep(1:3, 8),
Outcome = seq(10,50, length=24))
visits[1:2,]
base
visits
dim(base)
dim(visits)
merged.data <- merge(base, visits, by="id")
merged.data[1:5,]
dim(merged.data)
unique(base$id)
unique(visits$id)
dim(merged.data)
unique(merged.data$id)
?merge
all.data <- merge(base, visits, by="id", all=TRUE)
tail(all.data)
dim(all.data)
head(visits)
cbind(11, 1, 14.6)
cbind(visits, c(11, 1, 14.6))
rbind(visits, c(11, 1, 14.6))
vis2 = rbind(visits, c(11, 1, 14.6))
tail(vis2)
x = merge(base, vis2)
unique(x$id)
x = merge(base, vis2, all.y = TRUE)
tail(x)
length(unique(x$id))
vis2$Age = rnorm(nrow(vis2), mean= 20, sd = 1)
head(vis2)
x = merge(base, vis2, all.y = TRUE, by = "id")
head(x)
x = merge(base, vis2, all.y = TRUE, by = "id", suffixes = c("_base", "_follow"))
head9x
head(x)
x = merge(base, vis2, by = "id", suffixes = c("_base", "_follow"))
head(x)
## ---- echo = FALSE-------------------------------------------------------
library(knitr)
opts_chunk$set(comment = "")
## ------------------------------------------------------------------------
library(dplyr)
library(tidyr)
## ------------------------------------------------------------------------
ex_data = read.csv("http://www.aejaffe.com/winterR_2016/data/Charm_City_Circulator_Ridership.csv", as.is = TRUE)
head(ex_data, 2)
## ------------------------------------------------------------------------
library(lubridate) # great for dates!
ex_data = mutate(ex_data, date = mdy(date))
nrow(ex_data[ is.na(ex_data$date), ])
head(ex_data$date)
class(ex_data$date)
## ------------------------------------------------------------------------
library(stringr)
cn = colnames(ex_data)
cn = cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
## ------------------------------------------------------------------------
ex_data$daily = NULL
## ------------------------------------------------------------------------
long = gather(ex_data, "var", "number",
starts_with("orange"),
starts_with("purple"),
starts_with("green"),
starts_with("banner"))
head(long)
table(long$var)
## ------------------------------------------------------------------------
long = separate_(long, "var",
into = c("line", "type"),
sep = "[.]")
head(long)
table(long$line)
table(long$type)
## ------------------------------------------------------------------------
# have to remove missing days
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
## ------------------------------------------------------------------------
# wide = wide %>%
#     select(Alightings, Average, Boardings) %>%
#     mutate(good = rowSums(is.na(.)) > 0)
namat = !is.na(select(wide, Alightings, Average, Boardings))
head(namat)
wide$good = rowSums(namat) > 0
head(wide, 3)
## ------------------------------------------------------------------------
wide = filter(wide, good) %>% select(-good)
head(wide)
## ----merging-------------------------------------------------------------
base <- data.frame(id = 1:10, Age= seq(55,60, length=10))
base[1:2,]
visits <- data.frame(id = rep(1:8, 3), visit= rep(1:3, 8),
Outcome = seq(10,50, length=24))
visits[1:2,]
## ----merging2------------------------------------------------------------
merged.data <- merge(base, visits, by="id")
merged.data[1:5,]
dim(merged.data)
## ----mergeall------------------------------------------------------------
all.data <- merge(base, visits, by="id", all=TRUE)
tail(all.data)
dim(all.data)
## ----left_join-----------------------------------------------------------
lj = left_join(base, visits)
dim(lj)
tail(lj)
## ----right_join----------------------------------------------------------
rj = right_join(base, visits)
dim(rj)
tail(rj)
## ----full_join-----------------------------------------------------------
fj = full_join(base, visits)
dim(fj)
tail(fj)
## ------------------------------------------------------------------------
args(tapply)
## ------------------------------------------------------------------------
tapply(wide$Average, wide$line, mean, na.rm = TRUE)
## ------------------------------------------------------------------------
gb = group_by(wide, line)
summarize(gb, mean_avg = mean(Average))
rest = tapply(wide$Average, wide$line, mean, na.rm = TRUE)
## ------------------------------------------------------------------------
gb = group_by(wide, line)
ress = summarize(gb, mean_avg = mean(Average))
class(rest0
class(rest)
rest
names(res)
names(rest)
class(ress)
ress %>% filter(line == "banner")
ress %>% filter(line %in% "banner")
ress %>% filter(line %in% c("banner", "green"))
gb
class(gb)
?ungroup()
groups(gb)
wide %>%
group_by(line) %>%
summarize(gb, mean_avg = mean(Average))
wide %>%
group_by(line) %>%
summarize(mean_avg = mean(Average))
wide %>%
group_by(line) %>%
summarize(mean_avg = mean(Average),
mean_alight = mean(Alightings))
head(wide)
head(gb)
gb$day
wide$day
head(gb)
nrow(gb)
nrow(wide)
ncol(wide)
ncol(gb)
ss = wide %>%
group_by(line) %>%
summarize(mean_avg = mean(Average),
mean_alight = mean(Alightings))
ss
as.data.frame(ss)
ss = as.data.frame(ss)
wide %>%
group_by(line) %>%
summarize(mean_boarding = mean(Boardings),
mean_alight = mean(Alightings))
wide %>%
group_by(line) %>%
summarize(mean_boarding = mean(Boardings, na.rm = TRUE),
mean_alight = mean(Alightings, na.rm = TRUE))
ss = wide %>%
group_by(line) %>%
summarize(mean_boarding = mean(Boardings, na.rm = TRUE),
mean_alight = mean(Alightings, na.rm = TRUE))
ss
class(ss)
sss = as.data.frame(ss)
sss
wide %>%
group_by(line) %>%
summarise(mean_avg = mean(Average))
## ------------------------------------------------------------------------
wide = wide %>% mutate(year = year(date),
month = month(date))
wide %>%
group_by(line, year) %>%
summarise(mean_avg = mean(Average))
wide = wide %>% mutate(year = year(date),
month = month(date))
wide %>%
group_by(line, year) %>%
summarise(mean_boardings = mean(Boarding))
wide = wide %>% mutate(year = year(date),
month = month(date))
wide %>%
group_by(line, year) %>%
summarise(mean_boardings = mean(Boardings))
wide %>%
group_by(line, year) %>%
summarise(mean_boardings = mean(Boardings, na.rm = TRUE))
expand.grid(line = c("banner", "green"),  year = 2010:2015)
wide %>%
group_by(line, year) %>%
summarise(mean_boardings = mean(Boardings, na.rm = TRUE))
wide %>%
group_by(line, year) %>%
summarise(
mean_boardings = mean(Boardings))
ss = wide %>%
group_by(line, year) %>%
summarise(
mean_boardings = mean(Boardings))
ss$mean_boardings[ is.na(ss$mean_boardings)] = c("Missing")
ss
ss$mean_boardings
ss = wide %>%
group_by(line, year) %>%
summarise(
mean_boardings = mean(Boardings, na.rm=TRUE),
num_na = sum(is.na(Boardings)))
head(ss)
head(ss, 10)
all_years = expand.grid(
line = c("banner", "green"),
year = 2010:2015)
all_years
merge(ss, all_years, all.y = TRUE)
