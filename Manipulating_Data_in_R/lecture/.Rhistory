ex_data = read.csv("../../data/Charm_City_Circulator_Ridership.csv")
head(ex_data)
library(lubridate)
ex_data = mutate(ex_data, date = dmy(date))
source('~/.active-rstudio-document', echo=TRUE)
head(ex_data)
?gather
gather(ex_data, date, everything())
gather(ex_data, "date", "number", starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", "daily"))
gather(ex_data, "date", "number", starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", starts_with("daily")))
long = gather(ex_data, "date", "number", starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", starts_with("daily")))
head(long)
source('~/.active-rstudio-document', echo=TRUE)
long = gather(ex_data, "type", "number",
starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", starts_with("daily")))
head(long)
unique(long$type)
table(long$type)
head(long)
head(ex_data)
long = gather(ex_data, "type", "number",
starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", matches("daily")))
head(long)
table(long$type)
head(long)
?gather
long = gather(ex_data, "type", "number",
starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner", one_of("daily")))
head(long)
table(long$type)
head(long)
long$daily
head(ex_data)
ex_data$day
ex_data$daily
long = gather(ex_data, "type", "number",
starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner"), one_of("daily"))
long = gather(ex_data, "type", "number",
starts_with("orange"),
starts_with("purple"), starts_with("green"),
starts_with("banner"), starts_with("daily"))
head(long)
table(long$type)
head(daily)
head(long)
?separate
?reanem
?rename
library(stringr)
cn = colnames(ex_data)
cn
?str_replace
cn %>% str_replace("Board", ".Board")
?separate
source('~/.active-rstudio-document', echo=TRUE)
long = separate_(long, "var", into = "line type", sep = "[.]")
head(long)
source('~/.active-rstudio-document', echo=TRUE)
head(long)
source('~/.active-rstudio-document', echo=TRUE)
head(long)
library(stringr)
cn = colnames(ex_data)
cn %>%
str_replace("Board", ".Board") %>%
str_replace("Alight", ".Alight") %>%
str_replace("Average", ".Average")
colnames(ex_data) = cn
cn
source('~/.active-rstudio-document', echo=TRUE)
head(long)
ll = separate_(long, "var", into = c("line", "type"), sep = "[.]")
head(ll)
long = separate_(long, "var", into = c("line", "type"), sep = "[.]")
head(long)
table(long$line)
table(long$type)
?spread
?gather
?spread
wide = spread(long, key = type)
wide = spread(long, key = type, time)
hed(long)
head(long)
wide = spread(long, key = type, number)
library(dplyr)
stocks <- data.frame(
time = as.Date('2009-01-01') + 0:9,
X = rnorm(10, 0, 1),
Y = rnorm(10, 0, 2),
Z = rnorm(10, 0, 4)
)
stocksm <- stocks %>% gather(stock, price, -time)
stocksm
stocksm %>% spread(stock, price)
head(long)
?spread
wide = spread(long, key = type, line, number)
df <- data.frame(x = c("a", "b"), y = c(3, 4), z = c(5, 6))
head(df)
df
df %>% spread(x, y)
number
wide = spread(long, line, number)
iris.df = as.data.frame(iris)
iris.df$row <- 1:nrow(iris.df) ## added explicit row numbers
long <- gather(iris.df, vars, val, -Species, -row) ## and made sure to keep em
head(long)
spread(long)
wide = spread(long, line, number)
source('~/.active-rstudio-document', echo=TRUE)
head(long)
wide = spread(long, line, number, day, date)
head(long)
wide = filter(long, !is.na(date))
head(wide)
wide = spread(wide, line, number, day, date)
wide = spread(wide, line, number)
head(wide)
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
# have to remove missing days
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
wide$bad = rowSums(select(wide, Alightings, Average, Boardings))
head(wide)
wide$bad = rowSums(!is.na(select(wide, Alightings, Average, Boardings)))
head(wide)
wide$good = rowSums(!is.na(select(wide, Alightings, Average, Boardings))) > 0
head(wide)
wide = wide %>%
select(Alightings, Average, Boardings) %>%
mutate(good = rowSums(.) > 0 )
hed(wide)
head(wide)
wide = wide %>%
select(Alightings, Average, Boardings) %>%
mutate(good = rowSums(is.na(.)) > 0 )
head(wide)
namat = !is.na(select(wide, Alightings, Average, Boardings))
head(namat)
wide$good = rowSums(namat) > 0
head(wide)
wide = filter(long, !is.na(date))
wide = spread(wide, type, number)
head(wide)
```
namat = !is.na(select(wide, Alightings, Average, Boardings))
head(namat)
wide$good = rowSums(namat) > 0
head(wide, 2)
head(wide, 3)
wide = filter(wide, good)
head(wide)
wide = filter(wide, good) %>% select(-good)
head(wide)
tapply(wide$Alightings, wide$line, mean, na.rm = TRUE)
tapply(wide$Average, wide$line, mean, na.rm = TRUE)
gb = group_by(wide, line)
summarize(gb, mean_avg = mean(Average))
wide = wide %>% mutate(year = year(date))
head(wide)
wide = wide %>% mutate(year = year(date))
wide %>%
group_by(line, year) %>%
summarise(mean_avg = mean(Average))
library(ggplot2)
g = ggplot(aes(x = date, y = Average,
colour = line)) + geom_line()
library(ggplot2)
g = ggplot(aes(x = date, y = Average,
colour = line), data = wide) + geom_line()
g
source('~/.active-rstudio-document', echo=TRUE)
g
library(ggplot2)
g = ggplot(aes(x = month,
y = Average,
colour = line), data = wide) + geom_boxplot()
g
head(wide)
library(ggplot2)
g = ggplot(aes(x = factor(month),
y = Average,
colour = line), data = wide) + geom_boxplot()
g
source('~/.active-rstudio-document', echo=TRUE)
mon
library(ggplot2)
mon = wide %>%
group_by(line, month, year) %>%
summarise(mean_avg = mean(Average))
mon
library(ggplot2)
mon = wide %>%
group_by(line, month, year) %>%
summarise(mean_avg = mean(Average))
mon = mutate(mon,
mid_month = dmy(paste0("15-", month, "-", year)))
head(mon)
library(ggplot2)
mon = wide %>%
group_by(line, month, year) %>%
summarise(mean_avg = mean(Average))
mon = mutate(mon,
mid_month = dmy(paste0("15-", month, "-", year)))
g = ggplot(aes(x = mon,
y = Average,
colour = factor(month)), data = wide) + geom_line()
library(ggplot2)
mon = wide %>%
group_by(line, month, year) %>%
summarise(mean_avg = mean(Average))
mon = mutate(mon,
mid_month = dmy(paste0("15-", month, "-", year)))
g = ggplot(aes(x = mid_month,
y = Average,
colour = line), data = mon) + geom_line()
head(mon)
g
library(ggplot2)
mon = wide %>%
group_by(line, month, year) %>%
summarise(mean_avg = mean(Average))
mon = mutate(mon,
mid_month = dmy(paste0("15-", month, "-", year)))
g = ggplot(aes(x = mid_month,
y = mean_avg,
colour = line), data = mon) + geom_line()
g
```{r}
library(ggplot2)
g = ggplot(aes(x = date,
y = Average,
colour = line), data = wide) + geom_line()
g
source('~/.active-rstudio-document', echo=TRUE)
g
?stat_function
?geom_smooth()
g = ggplot(aes(x = date,
y = Average,
colour = line), data = wide) +
geom_smooth(se = FALSE)
g
g = ggplot(aes(x = date,
y = Average,
colour = line), data = wide) +
geom_smooth(se = FALSE) + geom_point()
```
g
g = ggplot(aes(x = date,
y = Average,
colour = line), data = wide) +
geom_smooth(se = FALSE) + geom_point(size = .5)
g
